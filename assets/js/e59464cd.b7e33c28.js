"use strict";(self.webpackChunknodejs_mobile_docs=self.webpackChunknodejs_mobile_docs||[]).push([[361],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=i,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||o;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4866:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var a=n(7462),i=(n(7294),n(3905));const o={sidebar_position:1,title:"Getting started"},r=void 0,l={unversionedId:"guide/guide-react-native/getting-started",id:"guide/guide-react-native/getting-started",title:"Getting started",description:"Creating your project",source:"@site/docs/guide/guide-react-native/getting-started.md",sourceDirName:"guide/guide-react-native",slug:"/guide/guide-react-native/getting-started",permalink:"/docs/guide/guide-react-native/getting-started",draft:!1,editUrl:"https://github.com/nodejs-mobile/nodejs-mobile.github.io/tree/main/docs/guide/guide-react-native/getting-started.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Getting started"},sidebar:"docs",previous:{title:"Building complex projects",permalink:"/docs/guide/guide-ios/building-complex"},next:{title:"F.A.Q.",permalink:"/docs/guide/faq"}},s={},d=[{value:"Creating your project",id:"creating-your-project",level:3},{value:"Installing the plugin",id:"installing-the-plugin",level:3},{value:"iOS",id:"ios",level:4},{value:"Android",id:"android",level:4},{value:"Writing the app code",id:"writing-the-app-code",level:3},{value:"The Node.js side",id:"the-nodejs-side",level:4},{value:"Node Modules",id:"node-modules",level:4},{value:"Native Modules",id:"native-modules",level:4},{value:"The React Native side",id:"the-react-native-side",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Duplicate module name",id:"duplicate-module-name",level:3},{value:"Bridge APIs",id:"bridge-apis",level:3},{value:"Native Modules Sample",id:"native-modules-sample",level:3}],p={toc:d},c="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"creating-your-project"},"Creating your project"),(0,i.kt)("p",null,"To start, you must first initialize a React Native project that uses ",(0,i.kt)("em",{parentName:"p"},"native code")," (not Expo Go), as described in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Setting up the development environment")," section of React Native's Environment Setup page."),(0,i.kt)("h3",{id:"installing-the-plugin"},"Installing the plugin"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install nodejs-mobile-react-native --save\n")),(0,i.kt)("p",null,"For iOS, run ",(0,i.kt)("inlineCode",{parentName:"p"},"pod install")," for linking the native code parts:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd iOS && pod install\n")),(0,i.kt)("h4",{id:"ios"},"iOS"),(0,i.kt)("p",null,"Universal binaries are included in the plugin, so you can run in both iOS simulators and devices."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile-react-native")," supports iOS 11.0 or later. In order to archive the application, the deployment target needs to be iOS 11.0 or later."),(0,i.kt)("h4",{id:"android"},"Android"),(0,i.kt)("p",null,"You may need to open your app's ",(0,i.kt)("inlineCode",{parentName:"p"},"/android")," folder in Android Studio, so that it detects, downloads and cofigures requirements that might be missing, like the NDK and CMake to build the native code part of the project."),(0,i.kt)("p",null,"You can also set the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"ANDROID_NDK_HOME"),", as in this example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export ANDROID_NDK_HOME=/Users/username/Library/Android/sdk/ndk/24.0.8215888\n")),(0,i.kt)("h3",{id:"writing-the-app-code"},"Writing the app code"),(0,i.kt)("h4",{id:"the-nodejs-side"},"The Node.js side"),(0,i.kt)("p",null,"When ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile-react-native")," is installed with npm, it creates a ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-assets/nodejs-project/")," folder inside your application's root folder. That's your app's ",(0,i.kt)("strong",{parentName:"p"},"node home path"),". It's where you put your app's Node.js code, and its contents will be packaged with your application."),(0,i.kt)("p",null,"When you use the ",(0,i.kt)("inlineCode",{parentName:"p"},"start(filename)")," function exposed by the plugin, the Node.js engine will load and execute the specified file from your app's node home path."),(0,i.kt)("p",null,"During installation, the plugin pre-populates the node home path with a few goodies: ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-main.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-package.json"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-main.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-package.json")," files contain a boilerplate echo project, which you can use to quickly get started. Simply copy ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-main.js")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"main.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-package.json")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Attention: ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-main.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-package.json")," will be overwritten with installs/updates of ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile-react-native"),".")),(0,i.kt)("p",null,"The plugin includes a ",(0,i.kt)("strong",{parentName:"p"},"React Native bridge")," module that allows communicating between your Node.js code and your React Native code. It's added as a built-in module to your Node.js environment and can be included by ",(0,i.kt)("inlineCode",{parentName:"p"},"require('rn-bridge')"),"."),(0,i.kt)("p",null,"The bridge functioning is well illustrated by the code in ",(0,i.kt)("inlineCode",{parentName:"p"},"sample-main.js"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const rn_bridge = require('rn-bridge');\n\n// Echo every message received from react-native.\nrn_bridge.channel.on('message', (msg) => {\n  rn_bridge.channel.send(msg);\n} );\n\n// Inform react-native node is initialized.\nrn_bridge.channel.send('Node was initialized.');\n")),(0,i.kt)("p",null,"The Node.js runtime accesses files through Unix-based pathnames, so in Android the node project is copied from the project's apk assets into the default application data folder at startup, during the first run or after an update, under ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-project/"),"."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Given the project folder will be overwritten after each application update, it should not be used for persistent storage.")),(0,i.kt)("p",null,"To expedite the process of extracting the assets files, instead of parsing the assets hierarchy, a list of files ",(0,i.kt)("inlineCode",{parentName:"p"},"file.list")," and a list of folders ",(0,i.kt)("inlineCode",{parentName:"p"},"dir.list")," are created when the application is compiled and then added to the application assets. On Android 6.x and older versions, this allows to work around a serious perfomance bug in the Android assets manager."),(0,i.kt)("h4",{id:"node-modules"},"Node Modules"),(0,i.kt)("p",null,"Node modules can be added to the project using ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-assets/nodejs-project/"),", as long as there's a ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," already present."),(0,i.kt)("h4",{id:"native-modules"},"Native Modules"),(0,i.kt)("p",null,"On Linux and macOS, there is support for building modules that contain native code."),(0,i.kt)("p",null,"The plugin automatically detects native modules inside your ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-project")," folder by searching for ",(0,i.kt)("inlineCode",{parentName:"p"},".gyp")," files. It's recommended to have the build prerequisites mentioned in ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile")," for Android and iOS. For Android it's also recommended that you set the ",(0,i.kt)("inlineCode",{parentName:"p"},"ANDROID_NDK_HOME")," environment variable in your system."),(0,i.kt)("p",null,"Building native modules for Android can take a long time, since it depends on building a standalone NDK toolchain for each required architecture. The resulting ",(0,i.kt)("inlineCode",{parentName:"p"},".node")," binaries are then included in the final application in a separate asset path for each architecture and the correct one will be chosen at runtime."),(0,i.kt)("p",null,"While the plugin tries to detect automatically the presence of native modules, there's a way to override this detection and turn the native modules build process on or off, by creating the ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-assets/BUILD_NATIVE_MODULES.txt")," file and setting its contents to ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"0"),", respectively. This can be used to start your application like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'echo "1" > nodejs-assets/BUILD_NATIVE_MODULES.txt\nreact-native run-android\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'echo "1" > nodejs-assets/BUILD_NATIVE_MODULES.txt\nreact-native run-ios\n')),(0,i.kt)("h3",{id:"the-react-native-side"},"The React Native side"),(0,i.kt)("p",null,"To communicate with Node.js from your React Native application, first import ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile-react-native"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import nodejs from 'nodejs-mobile-react-native';\n")),(0,i.kt)("p",null,"Then add this effect to your App component's:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"React.useEffect(() => {\n  nodejs.start('main.js');\n  nodejs.channel.addListener('message', (msg) => {\n    console.log('From node: ' + msg);\n  });\n});\n")),(0,i.kt)("p",null,"This will start a dedicated thread running Node.js, and execute the ",(0,i.kt)("inlineCode",{parentName:"p"},"main.js")," file in ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-assets/nodejs-project/"),", as described above. It will then register a listener to show alert boxes with each message sent from Node.js."),(0,i.kt)("p",null,"We can then define a button in our interface to send messages to our Node.js project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"<Button title=\"Message Node\"\n  onPress={() => nodejs.channel.send('A message!')}\n  />\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"An app cannot have more than one instance of the Node.js engine. The first call to ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs.start()")," will start the engine in a dedicated thread, and any further calls will have no effect. This means that if you use React Native's hot reload functionality your Node.js code will maintain the same state across hot reloads.")),(0,i.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("p",null,"For Android applications, the React Native build process is sometimes unable to rebuild assets. If you are getting errors while building the application using ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native run-android"),", the following commands can help you do a clean rebuild of the project, when run in your project's folder."),(0,i.kt)("p",null,"On macOS/Linux:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd android\n./gradlew clean\ncd ..\nreact-native run-android\n")),(0,i.kt)("p",null,"On Windows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd android\ngradlew clean\ncd ..\nreact-native run-android\n")),(0,i.kt)("h3",{id:"duplicate-module-name"},"Duplicate module name"),(0,i.kt)("p",null,"During the React Native application's build process, the ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-project")," gets copied to the application's assets, where they'll be used by ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-mobile"),". The React Native packager monitors the project's folder for javascript packages and may throw a ",(0,i.kt)("inlineCode",{parentName:"p"},'"jest-haste-map: Haste module naming collision"')," error."),(0,i.kt)("p",null,"To avoid this error, instruct the React Native packager to ignore the ",(0,i.kt)("inlineCode",{parentName:"p"},"nodejs-project")," and the platform folders where it is copied to. Edit the ",(0,i.kt)("inlineCode",{parentName:"p"},"metro.config.js")," file in your React Native project's root path with the following contents if you're using recent versions of ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native")," (",(0,i.kt)("inlineCode",{parentName:"p"},">= v0.60"),") and add the ",(0,i.kt)("inlineCode",{parentName:"p"},"blacklist")," require and the following resolver to the module exports:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const blacklist = require('metro-config/src/defaults/blacklist');\n\nmodule.exports = {\n  resolver: {\n    blacklistRE: blacklist([\n      /\\/nodejs-assets\\/.*/,\n      /\\/android\\/.*/,\n      /\\/ios\\/.*/\n    ])\n  },\n\n//...\n\n};\n")),(0,i.kt)("h3",{id:"bridge-apis"},"Bridge APIs"),(0,i.kt)("p",null,"For a description of the available APIs see the ",(0,i.kt)("a",{parentName:"p",href:"../../api/react-native-bridge"},"React Native bridge API reference"),"."),(0,i.kt)("h3",{id:"native-modules-sample"},"Native Modules Sample"),(0,i.kt)("p",null,"There's a sample that can be downloaded from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nodejs-mobile/nodejs-mobile-samples"},"samples repo")," that showcases the use of the ",(0,i.kt)("inlineCode",{parentName:"p"},"sha3")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"sqlite3")," native modules in React Native."))}u.isMDXComponent=!0}}]);