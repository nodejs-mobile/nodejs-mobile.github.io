"use strict";(self.webpackChunknodejs_mobile_docs=self.webpackChunknodejs_mobile_docs||[]).push([[821],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var d=r.createContext({}),s=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(d.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=s(n),m=i,h=c["".concat(d,".").concat(m)]||c[m]||u[m]||o;return n?r.createElement(h,a(a({ref:t},p),{},{components:n})):r.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=m;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l[c]="string"==typeof e?e:i,a[1]=l;for(var s=2;s<o;s++)a[s]=n[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5749:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var r=n(7462),i=(n(7294),n(3905));const o={sidebar_position:1,title:"Getting started"},a=void 0,l={unversionedId:"guide/guide-ios/getting-started",id:"guide/guide-ios/getting-started",title:"Getting started",description:"Download the library",source:"@site/docs/guide/guide-ios/getting-started.md",sourceDirName:"guide/guide-ios",slug:"/guide/guide-ios/getting-started",permalink:"/docs/guide/guide-ios/getting-started",draft:!1,editUrl:"https://github.com/nodejs-mobile/nodejs-mobile.github.io/tree/main/docs/guide/guide-ios/getting-started.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Getting started"},sidebar:"docs",previous:{title:"Redirect output streams to logcat",permalink:"/docs/guide/guide-android/redirect-to-logcat"},next:{title:"Building complex projects",permalink:"/docs/guide/guide-ios/building-complex"}},d={},s=[{value:"Download the library",id:"download-the-library",level:3},{value:"Creating your First Project",id:"creating-your-first-project",level:3},{value:"Development Prerequisites",id:"development-prerequisites",level:3},{value:"Create an Xcode Project",id:"create-an-xcode-project",level:3},{value:"Add NodeMobile.framework to the project",id:"add-nodemobileframework-to-the-project",level:3},{value:"Copy the library files",id:"copy-the-library-files",level:4},{value:"Add <code>NodeMobile.framework</code> to the app bundle",id:"add-nodemobileframework-to-the-app-bundle",level:4},{value:"Turn <code>ENABLE_BITCODE</code> off",id:"turn-enable_bitcode-off",level:4},{value:"Create the NodeRunner object that will run the Node.js engine",id:"create-the-noderunner-object-that-will-run-the-nodejs-engine",level:3},{value:"Create NodeRunner.h",id:"create-noderunnerh",level:4},{value:"Create NodeRunner.mm",id:"create-noderunnermm",level:4},{value:"Start a background thread to run startNodeWithArguments",id:"start-a-background-thread-to-run-startnodewitharguments",level:3},{value:"Run the Application",id:"run-the-application",level:3},{value:"Add simple UI to test",id:"add-simple-ui-to-test",level:3},{value:"Create Button and TextView",id:"create-button-and-textview",level:4},{value:"Add UI properties and connect them",id:"add-ui-properties-and-connect-them",level:4}],p={toc:s},c="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"download-the-library"},"Download the library"),(0,i.kt)("p",null,"The iOS shared libraries are distributed in a zip file, which you can download from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nodejs-mobile/nodejs-mobile/releases"},"core library release page"),"."),(0,i.kt)("p",null,"The zip file contains the 64 bit universal and device-only ",(0,i.kt)("inlineCode",{parentName:"p"},"NodeMobile.framework")," binaries for iOS 11. The universal ",(0,i.kt)("inlineCode",{parentName:"p"},"Release-universal/NodeMobile.framework")," contains both simulator and device binary code and should be used for development, while the device-only ",(0,i.kt)("inlineCode",{parentName:"p"},"Release-iphoneos/NodeMobile.framework")," only contains device binary code and should be used for App store submissions."),(0,i.kt)("h3",{id:"creating-your-first-project"},"Creating your First Project"),(0,i.kt)("p",null,"The following steps will guide you through creating an Xcode 9 project that uses the library. The complete project can also be downloaded from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nodejs-mobile/nodejs-mobile-samples"},"samples repo"),"."),(0,i.kt)("p",null,"This sample runs the Node.js engine in a background thread to start an HTTP server on port 3000 and return the ",(0,i.kt)("inlineCode",{parentName:"p"},"process.versions")," value. The app's Main Activity UI has a button to query the server and show the server's response. Alternatively, it's also possible to access the server from a browser running on a different device connected to the same local network."),(0,i.kt)("h3",{id:"development-prerequisites"},"Development Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A macOS device with Xcode version 9 or higher, with the iOS SDK version 11.0 or higher."),(0,i.kt)("li",{parentName:"ul"},"An iOS device with arm64 architecture, running iOS version 11.0 or higher."),(0,i.kt)("li",{parentName:"ul"},"A valid Apple Developer Account.")),(0,i.kt)("h3",{id:"create-an-xcode-project"},"Create an Xcode Project"),(0,i.kt)("p",null,'Using Xcode\'s "Create a new Xcode Project" wizard, create a new Project with the following settings, by the order the options appear in screens:'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"iOS Single View App")," template selected"),(0,i.kt)("li",{parentName:"ol"},"Enter in the ",(0,i.kt)("inlineCode",{parentName:"li"},"ProductName")," the ",(0,i.kt)("inlineCode",{parentName:"li"},"native-xcode")," name and leave the other fields with their defaults, which were, in our case:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Team: None"),(0,i.kt)("li",{parentName:"ul"},"Organization Name: Sample Org"),(0,i.kt)("li",{parentName:"ul"},"Organization Identifier: com.sampleorg"),(0,i.kt)("li",{parentName:"ul"},"Language: Objective-C"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Use Core Data")," unselected"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Include Unit Tests")," unselected"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Include UI Tests")," unselected")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Selected a path for my project"),(0,i.kt)("li",{parentName:"ol"},"Create")),(0,i.kt)("h3",{id:"add-nodemobileframework-to-the-project"},"Add NodeMobile.framework to the project"),(0,i.kt)("h4",{id:"copy-the-library-files"},"Copy the library files"),(0,i.kt)("p",null,"Create the ",(0,i.kt)("inlineCode",{parentName:"p"},"libnode/")," folder path in the project's root folder, next to the ",(0,i.kt)("inlineCode",{parentName:"p"},"native-xcode.xcodeproj")," package. Unzip the downloaded zip file, and copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"NodeMobile.framework")," from the ",(0,i.kt)("inlineCode",{parentName:"p"},"Release-universal/")," path inside the zip file to the ",(0,i.kt)("inlineCode",{parentName:"p"},"libnode/")," folder that was just created."),(0,i.kt)("h4",{id:"add-nodemobileframework-to-the-app-bundle"},"Add ",(0,i.kt)("inlineCode",{parentName:"h4"},"NodeMobile.framework")," to the app bundle"),(0,i.kt)("p",null,"In the project settings (click on the project main node), drag the ",(0,i.kt)("inlineCode",{parentName:"p"},"NodeMobile.framework")," file that is inside ",(0,i.kt)("inlineCode",{parentName:"p"},"libnode/"),", from a Finder Window to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Embedded Binaries")," portion of the ",(0,i.kt)("inlineCode",{parentName:"p"},"General")," tab. This will add the framework to both the ",(0,i.kt)("inlineCode",{parentName:"p"},"Embedded Binaries")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Linked Frameworks and Libraries")," section."),(0,i.kt)("h4",{id:"turn-enable_bitcode-off"},"Turn ",(0,i.kt)("inlineCode",{parentName:"h4"},"ENABLE_BITCODE")," off"),(0,i.kt)("p",null,"The Node binary isn't currently build with bitcode enabled, so, for the time being, we need to disable bitcode for the application as well."),(0,i.kt)("p",null,"In the project settings (click on the project main node), in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Build Options")," portion of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Build Settings")," tab, set ",(0,i.kt)("inlineCode",{parentName:"p"},"Enable Bitcode")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"No"),"."),(0,i.kt)("h3",{id:"create-the-noderunner-object-that-will-run-the-nodejs-engine"},"Create the NodeRunner object that will run the Node.js engine"),(0,i.kt)("h4",{id:"create-noderunnerh"},"Create NodeRunner.h"),(0,i.kt)("p",null,"Create a new header file in the project, in the same location as the already existing code files, and call it ",(0,i.kt)("inlineCode",{parentName:"p"},"NodeRunner.h"),"."),(0,i.kt)("p",null,"Add the following code to that file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec",metastring:'title="NodeRunner.h"',title:'"NodeRunner.h"'},"#ifndef NodeRunner_h\n#define NodeRunner_h\n#import <Foundation/Foundation.h>\n\n@interface NodeRunner : NSObject {}\n+ (void) startEngineWithArguments:(NSArray*)arguments;\n@end\n\n#endif\n")),(0,i.kt)("h4",{id:"create-noderunnermm"},"Create NodeRunner.mm"),(0,i.kt)("p",null,"Create a new Objective-C File in the project's structure in the same level as the already existing code files, called ",(0,i.kt)("inlineCode",{parentName:"p"},"NodeRunner.mm"),". The .mm extension is important as this will indicate Xcode that this file will contain C++ code in addition to Objective-C code."),(0,i.kt)("p",null,"This file will contain the following code to start node:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec",metastring:'title="NodeRunner.mm"',title:'"NodeRunner.mm"'},"#include \"NodeRunner.h\"\n#include <NodeMobile/NodeMobile.h>\n#include <string>\n\n@implementation NodeRunner\n\n//node's libUV requires all arguments being on contiguous memory.\n+ (void) startEngineWithArguments:(NSArray*)arguments\n{\n    int c_arguments_size=0;\n\n    //Compute byte size need for all arguments in contiguous memory.\n    for (id argElement in arguments)\n    {\n        c_arguments_size+=strlen([argElement UTF8String]);\n        c_arguments_size++; // for '\\0'\n    }\n\n    //Stores arguments in contiguous memory.\n    char* args_buffer=(char*)calloc(c_arguments_size, sizeof(char));\n\n    //argv to pass into node.\n    char* argv[[arguments count]];\n\n    //To iterate through the expected start position of each argument in args_buffer.\n    char* current_args_position=args_buffer;\n\n    //Argc\n    int argument_count=0;\n\n    //Populate the args_buffer and argv.\n    for (id argElement in arguments)\n    {\n        const char* current_argument=[argElement UTF8String];\n\n        //Copy current argument to its expected position in args_buffer\n        strncpy(current_args_position, current_argument, strlen(current_argument));\n\n        //Save current argument start position in argv and increment argc.\n        argv[argument_count]=current_args_position;\n        argument_count++;\n\n        //Increment to the next argument's expected position.\n        current_args_position+=strlen(current_args_position)+1;\n    }\n\n    //Start node, with argc and argv.\n    node_start(argument_count,argv);\n    free(args_buffer);\n}\n@end\n")),(0,i.kt)("h3",{id:"start-a-background-thread-to-run-startnodewitharguments"},"Start a background thread to run startNodeWithArguments"),(0,i.kt)("p",null,"The app uses a background thread to run the Node.js engine."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Currently, only a single instance of the Node.js runtime can be started within an application. Restarting the engine after it has finished running is also not supported.")),(0,i.kt)("p",null,"The Node code is a simple HTTP server on port 3000 that returns ",(0,i.kt)("inlineCode",{parentName:"p"},"process.versions"),". This is the corresponding Node code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst versions_server = http.createServer( (request, response) => {\n  response.end('Versions: ' + JSON.stringify(process.versions));\n});\nversions_server.listen(3000);\n")),(0,i.kt)("p",null,"For simplicity, the Node code is added to the ",(0,i.kt)("inlineCode",{parentName:"p"},"AppDelegate.m")," file."),(0,i.kt)("p",null,"Add the following line in the file #import section:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec"},'#import "NodeRunner.h"\n')),(0,i.kt)("p",null,"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},"startNode")," selector and start the thread inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"didFinishLaunchingWithOptions")," selector, which signature should be already have been created by the wizard:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec"},'- (void)startNode {\n    NSArray* nodeArguments = [NSArray arrayWithObjects:\n                                @"node",\n                                @"-e",\n                                @"var http = require(\'http\'); "\n                                " var versions_server = http.createServer( (request, response) => { "\n                                "   response.end(\'Versions: \' + JSON.stringify(process.versions)); "\n                                " }); "\n                                " versions_server.listen(3000); "\n                                ,\n                                nil\n                                ];\n    [NodeRunner startEngineWithArguments:nodeArguments];\n}\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    NSThread* nodejsThread = nil;\n    nodejsThread = [[NSThread alloc]\n        initWithTarget:self\n        selector:@selector(startNode)\n        object:nil\n    ];\n    // Set 2MB of stack space for the Node.js thread.\n    [nodejsThread setStackSize:2*1024*1024];\n    [nodejsThread start];\n    return YES;\n}\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The iOS node runtime expects to have 1MB of stack space available. Having 2MB of stack space available is recommended.")),(0,i.kt)("h3",{id:"run-the-application"},"Run the Application"),(0,i.kt)("p",null,"You should now be able to run the application on your iOS device."),(0,i.kt)("p",null,"In the project settings (click on the project main node), in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Signing")," portion of the General tab, select a valid Team and handle the provisioning profile creation/update. If you get an error that the bundle identifier cannot be used, you can simply change the bundle identifier to a unique string by appending a few characters to it."),(0,i.kt)("p",null,"Try to run the app. If the build process doesn't start the app right away, you might have to go to ",(0,i.kt)("inlineCode",{parentName:"p"},"Settings > General")," in the device and enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"Device Management")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Profiles & Device Management")," screen to manually accept the profile."),(0,i.kt)("h3",{id:"add-simple-ui-to-test"},"Add simple UI to test"),(0,i.kt)("p",null,"At this point, it's already possible to run the app on an iOS device and access the HTTP server from any device connected to the same local network. If the iOS device's IP address is ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.1.100")," point the browser at ",(0,i.kt)("inlineCode",{parentName:"p"},"http://192.168.1.100:3000/"),"."),(0,i.kt)("p",null,"However, the sample also comes with the UI to query the local HTTP server and show the response."),(0,i.kt)("h4",{id:"create-button-and-textview"},"Create Button and TextView"),(0,i.kt)("p",null,"In ",(0,i.kt)("inlineCode",{parentName:"p"},"Main.storyboard"),", use the Xcode interface designer to create a UIButton and a UITextView components."),(0,i.kt)("h4",{id:"add-ui-properties-and-connect-them"},"Add UI properties and connect them"),(0,i.kt)("p",null,"Inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"ViewController.m")," file, add the ",(0,i.kt)("inlineCode",{parentName:"p"},"IBOutlet")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"IBAction")," declarations to the ",(0,i.kt)("inlineCode",{parentName:"p"},"interface")," section:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec"},"@interface ViewController ()\n@property (weak, nonatomic) IBOutlet UIButton *myButton;\n@property (weak, nonatomic) IBOutlet UITextView *myTextView;\n\n- (IBAction)myButtonAction:(id)sender;\n@end\n")),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"Assistant Editors")," mode of Xcode:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"@property (weak, nonatomic) IBOutlet UITextView *myTextView;")," property from ",(0,i.kt)("inlineCode",{parentName:"li"},"ViewController.m")," to the ",(0,i.kt)("inlineCode",{parentName:"li"},"UITextView")," previously created in ",(0,i.kt)("inlineCode",{parentName:"li"},"Main.storyboard"),"."),(0,i.kt)("li",{parentName:"ul"},"Connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"@property (weak, nonatomic) IBOutlet UIButton *myButton;")," property from ",(0,i.kt)("inlineCode",{parentName:"li"},"ViewController.m")," to the ",(0,i.kt)("inlineCode",{parentName:"li"},"UIButton")," previously created in ",(0,i.kt)("inlineCode",{parentName:"li"},"Main.storyboard"),"."),(0,i.kt)("li",{parentName:"ul"},"Connect the ",(0,i.kt)("inlineCode",{parentName:"li"},"- (IBAction)myButtonAction:(id)sender;")," selector from ",(0,i.kt)("inlineCode",{parentName:"li"},"ViewController.m")," to the ",(0,i.kt)("inlineCode",{parentName:"li"},"UIButton")," previously created in ",(0,i.kt)("inlineCode",{parentName:"li"},"Main.storyboard"),".")),(0,i.kt)("p",null,"Add the ",(0,i.kt)("inlineCode",{parentName:"p"},"- (IBAction)myButtonAction:(id)sender;")," definition to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ViewController.m")," implementation section:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objectivec"},'- (IBAction)myButtonAction:(id)sender\n{\n    NSString *localNodeServerURL = @"http:/127.0.0.1:3000/";\n    NSURL  *url = [NSURL URLWithString:localNodeServerURL];\n    NSString *versionsData = [NSString stringWithContentsOfURL:url];\n    if (versionsData)\n    {\n        [_myTextView setText:versionsData];\n    }\n}\n')),(0,i.kt)("p",null,"While the application is running on your device, tapping the button in the app sends a request to the local Node.js HTTP server and shows the response in the ",(0,i.kt)("inlineCode",{parentName:"p"},"TextView"),"."))}u.isMDXComponent=!0}}]);